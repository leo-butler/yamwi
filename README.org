#+TITLE: Introduction to Yamwi
#+OPTIONS: ^:{} toc:nil num:nil
#+AUTHOR: Leo Butler (based on README_en by Mario Rodríguez Riotorto)
#+MACRO: yamwiurl https://github.com/leo-butler/yamwi/
#+EMAIL: leo.butler@university.ca (university = UManitoba)

* Objectives
*Yamwi* ([[https://github.com/leo-butler/yamwi/][Yet Another Maxima Web Interface]]) is a web interface, based
on Linux+Apache+Php, to the computer algebra system *Maxima*
([[https://maxima.sourceforge.io/]]).

Maxima is the free version (GPL) of the Macsyma system developed in
Lisp at MIT beginning in the late nineteen sixties; other similar
programs (Mathematica, Maple) got inspired by it in the
eighties. Since 2000 Maxima is part of Sourceforge and maintained by
an international team of programers. Due to its advanced routines,
Maxima is also used in research and technical contexts.

Yamwi is of interest in educational contexts, to make interactive
activities with the browser, or to show mathematical concepts. All
sorts of computations and graphics can be made through the web by
Yamwi.

The original author of this software is Mario Rodríguez Riotorto. The
current maintainer is Leo Butler. See [[*Contact][contact information]].

* Screenshot
Here is a screenshot of *Yamwi* with output.

[[file:htdocs/yamwi-in-browser.png]]

* Requirements
The operating system to install Yamwi is Linux.

Software requirements on the server side:

- Apache :: (https://www.apache.org/). (Ver. >= 2).
- Php :: (https://www.php.net/). (Ver. >= 5).
- Maxima :: (https://maxima.sourceforge.io/). This is the mathematical engine. (Ver. >= 5.20).
- timelimit/timeout :: (https://devel.ringlet.net/sysutils/timelimit/ / https://www.gnu.org/software/coreutils/). Bound Maxima's computation time to a fixed limit.

** Recommended
Yamwi can be extended by installing the following software:

- Gnuplot :: (https://www.gnuplot.info/). This is the program used by Maxima for rendering graphics. (Ver. >= 4.2).
- FFmpeg :: (https://ffmpeg.org/). This program is used with ~Gnuplot~ by Maxima to create animations. (Ver. >= 5.0).

To enable ~Gnuplot~ (respectively, ~Gnuplot+FFmpeg~) is simple: the
administrator sets ~$gnuplot_binary~ to the pathname of the ~gnuplot~
program (respectively, sets both ~$gnuplot_binary~ and
~$ffmpeg_binary~ to point to the relevant programs). If Yamwi cannot
find ~gnuplot~, all plotting is disabled; if it cannot find ~ffmpeg~,
animations are disabled.

* Installation
Once the above-mentioned programs are installed, Yamwi's installation
is as easy as placing the Yamwi's files somewhere accesible to Apache.

Yamwi's source can be downloaded from {{{yamwiurl}}}.

This is the installation process: (requires root privileges)

1. Download the file =yamwi-yy.mm.tar.gz=, where =yy= stands for the
   year and =mm= for the month of release, and place it somewhere
   accesible from Apache. After that, untar it:
   #+begin_src shell :exports code
   tar -xvf yamwi-yy.mm.tar.gz
   #+end_src
   which creates a new folder called =yamwi=.

2. Execute the =INSTALL= script; it sets up directories and files with
   the neccesary permissions. It also creates temporary folder =tmp=,
   where working files will be placed:
   #+begin_src shell :exports code
   sh yamwi/INSTALL
   #+end_src

3. Installation is now complete, in order to play with the demos just
   type the following address in your browser:
   #+begin_src text :exports code
   http://localhost/path_to_folder/yamwi
   #+end_src
   where =path_to_folder= is not necessary if Yamwi was installed in
   Apache's root system.

** A minimal installation
A minimal installation can be achieved by cloning the repository
#+begin_src shell :exports code
  git clone $yamwiurl
#+end_src
Assuming that ~php~ is installed, the following launches Yamwi:
#+header: :var yamwi="."
#+begin_src shell :exports
  cd $yamwi
  mkdir tmp
  php -S localhost:8080
#+end_src

* Configuration
There are two configuration files for Yamwi.

** Package configuration
The file =yamwi-conf.php= contains the significant configuration options for Yamwi and sets defaults for those.

- ~mode~ ::  Can be one of 0, 1, 2, 3, 4 or 5. These options are:
  0. [@0] When 0, output is returned as a syntactical Maxima expression (in command-line ~maxima~, this is called ~1d~ output);
  1. when 1, Yamwi output is rendered in ASCII-Art style without any additional processing (in command-line ~maxima~, this is called ~2d~ output);
  2. when 2, results are rendered in enhanced ASCII-Art style, with syntax highlighting and other features that make it easier to read than mode 0 (in command-line ~maxima~, this is ~2d~ output);
  3. when 3, results are rendered using Maxima's =MathML= processor;
  4. when 4, results are based on the nice-looking MathJax (http://www.mathjax.org) system;
  5. when 5, results are printed as Lisp S-expressions (sexps).
  Defaults to 2. The user may select the mode.

- ~max_file_time~ ::  Yamwi creates some files which are stored in
  its ~tmp~ folder. Every time a user asks for a calculation, Yamwi
  removes those files older, in minutes, than the quantitity indicated
  by this variable. Defaults to 1.

- ~max_process_time~ ::  maximum execution time, in seconds, allowed
  for each Maxima process. Default value is 120 seconds.

- ~max_num_processes~ ::  maximum number of Maxima processes
  simultaneously running on the server. Default value is 30.

- ~timelimit_binary~ :: Name of the ~timelimit~ binary. Defaults to ~/usr/bin/timeout~.

- ~maxima_binary~ :: Name of the ~maxima~ binary. Defaults to ~/usr/bin/maxima~.

- ~maxima_args~ :: A string of optional arguments supplied to the ~maxima~ binary. Defaults to ~""~.

- ~gnuplot_binary~ :: Name of the ~gnuplot~ binary. Defaults to ~/usr/bin/gnuplot~.

- ~gnuplot_args~ :: A string of optional arguments supplied to the ~gnuplot~ binary.. Defaults to ~""~.

- ~magic_key~ :: A key that, when passed as part of the URL, causes Yamwi to return diagnostic information along with the normal output. This should be set by the system administrator.

- ~$movie_muxer~ :: The name of the container used by ~ffmpeg~ to produce a video, shown in a =<video>= element. Must by either =webm= or =mp4=. Defaults to =webm=.

- ~$movie_is_embedded~ :: If ~1~, the video made by ~ffmpeg~ is base-64 encoded and embedded in HTML; otherwise, the video is saved to file and the file-name is embedded in HTML.

- ~$ffmpeg_binary~ :: The name of the ~ffmpeg~ binary. Defaults to ~/usr/bin/ffmpeg~.

- ~$base64_cmd~ :: The command used to encode images and videos to base-64 encoding. Defaults to ~/usr/bin/base64 -w 0~.

** Site configuration
The file =site-conf.php= contains site-specific configuration options. While =yamwi-conf.php= is updated by the =INSTALL= script, this file will not be changed.
Site administrators should put all local configuration options in this file. By default, the file is created as an almost complete copy of =yamwi-conf.php=, with the settings commented out.

* User Packages
Yamwi gives access to all standard Maxima packages. Custom packages can be placed in the =packages= sub-directory. The file extension should be =.mac= if the package is written in Maxima code, or =.lisp= if it is written in Common Lisp. A Yamwi user can =load= these packages. See the help file =help_en.html=.

* Security
Take care when using this program. To mitigate the possibility of a successful attack on a Yamwi server, some barriers have been implemented:

- There is a list of so-called *dangerous words*, which prevents the execution of user code when one of these terms is detected in the input. See the global variable =$dangerous_words= in =yamwi.php=.
- The number of running Maxima processes can be limited. See the configuration variable =$max_num_processes=.
- The execution time of Maxima processes can be limited. See the configuration variable =$max_process_time=.

Even with these filters, operating Yamwi in a server environment does entail risk.

* License
This project is distributed under the terms of the GPL (General Public
License). For more information, read the LICENSE file.

* Release Notes
** Pending: Release 2026-MM-DD
*** Changes to the User-Interface
1. Input and output may now be displayed as Lisp S-expressions (Sexps). Users who are curious about how Maxima represents mathematical objects can use these display options.
2. Improve the handling of verbatim input (see [[https://github.com/leo-butler/yamwi/issues/5][Issue #5]]).
3. Improve the handling of error messages from Maxima and Gnuplot (SBCL, ECL; not GCL or CLISP).
4. Correct the TeX code for matrices (see [[https://github.com/leo-butler/yamwi/issues/6][Issue #6]]).
5. Print the Maxima banner as a header for the output, similar to other front-ends.

*** Security
*** Status
*** Lisps supported
Maxima runs on a variety of Common Lisp implementations. As of this
release, using a Debian 13 server installed on a virtual machine, the
following implementations are supported:

- SBCL, ECL :: fully supported.
- GCL :: partially supported, not recommended. There are multiple issues that hobble the use of GCL on a server:
  1. [X] Runs with Yamwi served on localhost.
  2. [ ] Recent versions of Maxima cannot be built with GCL.
  3. [ ] The Debian GCL-based Maxima package has majour problems compiling and loading the ~draw~ package.
  4. [ ] GCL's does not correctly re-bind the ~*error-output*~ stream. This limits error reporting compared to SBCL and ECL and necessitates a customized ~run-program~ (built on ~si:run-process~).
- Clisp :: unsupported. There are a few issues to be overcome.
  1. [X] Runs with Yamwi served on localhost.
  2. [ ] There are filesystem-access issues when run as part of Apache. Patches are invited.
  3. [ ] Clisp's implementation of ~run-program~ is broken (neither ~*standard-output*~ nor ~*error-output*~ can be correctly ~let~ bound in order to redirect these output streams). No good work-arounds are known to us.

*** Download
Download the tar.gz release file from the project webpage: [[https://github.com/leo-butler/yamwi/releases/]].

*** Reference implementation
A pair of live Yamwi servers are maintained by the project:
1. [[https://net124.reltub.ca/yamwi/]] serves the latest release of Yamwi.
2. [[https://net124.reltub.ca/yamwi-dev/]] serves the latest version of Yamwi from the =master= branch of the Github repository (it may take up to 24 hours to synchronize with HEAD).

** Release 2026-02-03
The *Yamwi* development team is pleased to announced a new release (v. 2026-02-03).

*Yamwi* ([[https://github.com/leo-butler/yamwi/][Yet Another Maxima Web Interface]]) is a web interface, based
on Linux+Apache+Php, to the computer algebra system [[https://maxima.sourceforge.io/][Maxima]]. Originally
developed by Mario Rodríguez Riotorto and hosted on Sourceforge, the
project is being continued by a new team of developers on Github.

Maxima is the free version (GPL) of the Macsyma system developed in
Lisp at MIT beginning in the late nineteen sixties; other similar
programs (Mathematica, Maple) got inspired by it in the
eighties. Since 2000 Maxima is part of Sourceforge and maintained by
an international team of programmers.

*** Changes to the User-interface
Some of the recent changes in the UI include:

- Maxima output may be displayed in five different ways (using 1d, 2d, syntax-highlighted 2d, MathML and MathJaX). The user can change the display format without requiring a page reload.
- Yamwi no longer provides server-side LaTeX-based images of the output. MathJaX or MathML provide faster, more secure options with higher quality results.
- Maxima input may be displayed either verbatim (default) or interpreted. The user can also change this format without requiring a page reload.
- Error handling has been improved: when Maxima needs additional information to continue a calculation, Yamwi now passes the question back to the user and halts further calculations.

**** Plotting-related changes
- Figures generated by ~plot~ or ~draw~ commands are embedded in the HTML page, which prevents most incidents of empty figures.
- The default output format for ~draw~ commands is ~svg~. The user may choose the output format from amongst the ~png~, ~pngcairo~, ~gif~, ~animated_gif~ and ~jpg~ terminals; other choices are ignored.
- The only output format for ~plot~ commands is ~svg~. Trying to set the output format causes an error.
- Animations are available, using the command ~draw_movie~. The syntax is simple, and explained with an example:
  #+begin_src maxima :exports code :results none
    draw_movie(lambda([param],
        draw2d(explicit(sin(x)+param,x,-%pi,%pi),yrange=[-2,2])),
        makelist(param/30,param,-30,30));
  #+end_src
  This first argument to ~draw_movie~ is a /function/ ~f~ of a single parameter ~param~. When evaluated ~f(param)~ should draw a figure using a ~draw~ function. The second argument of ~draw_movie~ is a list of parameter values. Optional additional arguments allow the user to set the input and output frame rates of the animation with the syntax ~ifr=N~ and ~ofr=M~. By default, ~N=M=30~, so thirty images are needed to make one second of video.
  In this example, a 2 second animation is created.

**** Shortcuts
- A menu of shortcuts are available for different Maxima functions. For example, the sample animation above can be run by pulling down the /Plot/ menu and choosing /Animation/.
- Users can save:
  - pages to PDF;
  - their commands to a =.mac= Maxima source file or to a =.wmx= wxMaxima source file.
- Users can load Maxima code from a file.
- Code is now encoded in a =GET= parameter, so users can exchange code via URLs (links). For example, the above example is available via the link:
  [[http://localhost:8080/index.php?c=2iekdzsb1pdhr04i6hlkc&n=0&mode=3&max=ZHJhd19tb3ZpZShsYW1iZGEoW3BhcmFtXSwKICAgIGRyYXcyZChleHBsaWNpdChzaW4oeCkrcGFyYW0seCwtJXBpLCVwaSkseXJhbmdlPVstMiwyXSkpLAogICAgbWFrZWxpc3QocGFyYW0vMzAscGFyYW0sLTMwLDMwKSk7Cg--]]
  The =max= parameter is the base64-encoded Maxima input.

*** Security

- The list of prohibited words has been increased. The goal is to eliminate access to the internals of Maxima, including the Yamwi-specific code and parameters.
- The ~php~ code has been simplified. There is only one function to handle Maxima's input and process the output (~calculate~).
- Access to ~Gnuplot~ is restricted. Access to Maxima variables of the form ~gnuplot_*~ is prohibited. Pre- and postambles are prohibited.
- Access to ~FFmpeg~ is restricted. Only ~draw_movie~ uses it and the only options available are the input and output frame rates.

*** Status
*Yamwi* is alpha-quality software. Since it exposes several pieces of
 software to the web, care should be taken to install it correctly and
 monitor it. This software comes without any warranty (see the LICENSE
 file for more details).

*** Lisps supported
Maxima runs on a variety of Common Lisp implementations. As of this
release, using a Debian 13 server installed on a virtual machine, the
following implementations are supported:

- SBCL, ECL :: fully supported.
- Clisp :: unsupported. There are a few issues to be overcome, although Clisp works when Yamwi is run on ~localhost~.
  1. There are filesystem-access issues when run as part of Apache. Patches are invited.
  2. Clisp's implementation of ~run-program~ is broken, without good work-arounds.
- GCL :: unsupported. There are multiple issues preventing the use of GCL:
  1. Recent versions of Maxima cannot be built with GCL.
  2. The Debian GCL-based Maxima package cannot compile and load the ~draw~ package.
  3. GCL's implementation of ~run-program~ (~si:run-process~) is also faulty.

*** Download
Download the tar.gz release file from the project webpage: [[https://github.com/leo-butler/yamwi/releases/]].

* Contact

For bug reports, suggestions or collaboration, feel free to contact
the project at [[https://github.com/leo-butler/yamwi/issues]].

* Installing on a VM                                               :noexport:
Let's set up a virtual machine (VM) to run =yamwi= in. I chose Debian,
because that is the Linux distribution that I have used for almost 20
years.

** A VM image
I got the latest debian image, the =sha512= sums, and then did a check:

#+begin_src sh :exports code :eval no-export
  wget https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-nocloud-amd64.qcow2
  wget https://cloud.debian.org/images/cloud/bookworm/20241004-1890/SHA512SUMS
  ln -s debian-12-nocloud-amd64.qcow2 debian-12-nocloud-amd64-20241004-1890.qcow2
  sha512sum -c SHA512SUMS
#+end_src

** A QEMU script
The =qemu= system must be installed. I installed the =qemu-system= package from Debian testing.
I have a script lying around:

#+begin_src shell :tangle ./yamwi-vm.sh :exports code :eval no-export
  #!/bin/bash
  set -aex

  # for monitor info, see https://superuser.com/questions/1087859/how-to-quit-the-qemu-monitor-when-not-using-a-gui

  DISPLAY=:0.0 qemu-system-x86_64 --enable-kvm -m 12G -boot menu=on,splash-time=10000 \
  	    -hda ./debian-12-nocloud-amd64.qcow2 \
  	    -monitor telnet::5557,server,nowait -serial mon:stdio \
  	    -device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp::6555-:22,\
  	    hostfwd=tcp::5913-:5913,hostfwd=tcp::9580-:80,hostfwd=tcp::9943-:443 \
  	    -monitor none -vnc 127.0.0.1:11,password=off \
  	    -echr 0x02 \
              -virtfs local,path=/etc,mount_tag=host0,security_model=passthrough,id=host0,readonly \
  	    #-runas qemu
#+end_src
